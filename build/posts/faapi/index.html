<!DOCTYPE html>
<html lang="en">
	<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KOTA YATAGAI | 八谷航太</title>
    <title>ブラウザからローカルフォントを取得する</title><meta name="description" content="Font Access APIでローカルにアクセス" data-svelte="svelte-189on1m"><meta property="og:url" content="https://kota-yata.com" data-svelte="svelte-189on1m"><meta property="og:title" content="ブラウザからローカルフォントを取得する" data-svelte="svelte-189on1m"><meta property="og:image" content="https://kota-yata.com/media/faapi.webp" data-svelte="svelte-189on1m"><meta property="og:description" content="Font Access APIでローカルにアクセス" data-svelte="svelte-189on1m"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-189on1m"><meta name="twitter:site" content="@kota_yata" data-svelte="svelte-189on1m">

		

		<link rel="modulepreload" href="/_app/start-daaae108.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-495f2134.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-be316660.js">
		<link rel="modulepreload" href="/_app/chunks/index-6747d163.js">
		<link rel="modulepreload" href="/_app/pages/posts/_path_.svelte-2d94d26d.js">
		<link rel="modulepreload" href="/_app/chunks/page-7b278a70.js">
		<link rel="modulepreload" href="/_app/chunks/className-0b25377b.js">
		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-0136ed43.css">
		<link rel="stylesheet" href="/_app/assets/app-d7359544.css">
		<link rel="stylesheet" href="/_app/assets/pages/posts/_path_.svelte-77f41461.css">
		<link rel="stylesheet" href="/_app/assets/page-da0bc829.css">

		<script type="module">
			import { start } from "/_app/start-daaae108.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-be316660.js"),
						import("/_app/pages/posts/_path_.svelte-2d94d26d.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "\u002Fposts\u002Ffaapi",
						query: new URLSearchParams(""),
						params: {path:"faapi"}
					}
				}
			});
		</script>
    <meta name="keyword" content="kota,yatagai,kota yatagai,八谷航太">
    <link rel="icon" href="/me.webp" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link defer
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet">
    <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
      integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
    <link defer rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/a11y-dark.min.css"
      integrity="sha384-Mt8bPDNu0L2sVzon3+a8Rqtl4fmqaUmTPBEd/DTHiGFEQEFvf0fYLnU1DgK+ER2h" crossorigin="anonymous">
	</head>
	<body>
		<div id="svelte">


<header class="svelte-gbfwkw"><div class="left svelte-gbfwkw"><a href="/" class="svelte-gbfwkw">KOTA YATAGAI</a></div>
  <div class="right svelte-gbfwkw"><select name="language"><option value="JP">Japanese</option><option value="EN">English</option></select>
    <a href="/trip" sveltekit:prefetch class="svelte-gbfwkw"><img alt="to trip page" src="/airplane.svg" width="30px" height="30px"></a></div></header>

<main class="svelte-gbfwkw">
  

<div class="container svelte-izy1ym"><div class="profile svelte-izy1ym"><div class="container svelte-g32fgp"><img alt="myself" src="/me.webp" width="150px" height="150px" class="svelte-g32fgp">
  <div class="bio svelte-g32fgp"><h4 class="svelte-g32fgp">八谷航太</h4>
    <p class="svelte-g32fgp">18yo / ソフトウェア開発者</p></div>
  <ul class="svelte-g32fgp"><li class="svelte-g32fgp"><a href="/" class="svelte-g32fgp">Home</a></li><li class="svelte-g32fgp"><a href="/about" class="svelte-g32fgp">About</a></li><li class="svelte-g32fgp"><a href="/works" class="svelte-g32fgp">Works</a></li><li class="svelte-g32fgp"><a href="/contacts" class="svelte-g32fgp">Contacts</a></li></ul>
  <div class="icons svelte-g32fgp"><a href="https://github.com/kota-yata" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/github.svg" width="20px" height="20px"></a><a href="https://open.spotify.com/user/jgm80x9h1j84hnk4nv3hozlaf" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/spotify.svg" width="20px" height="20px"></a><a href="https://twitter.com/kota_yata" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/twitter.svg" width="20px" height="20px"></a><a href="https://speakerdeck.com/kota_yata/" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/speakerdeck.svg" width="20px" height="20px"></a></div>
</div></div>
  <div class="slot svelte-izy1ym"><div class="info svelte-hf3o4"><h1 class="info-title svelte-hf3o4">ブラウザからローカルフォントを取得する</h1>
    <span class="info-date svelte-hf3o4">2020-11-25</span>
    <span class="info-category programming svelte-hf3o4">Programming</span></div>
  <!-- HTML_TAG_START --><p>Chrome87よりブラウザ上でインストール済みのフォントを調べるFont Access APIがOrigin Trialsに公開されました。正直このAPIで何か作ろうとは思っていませんが、このAPIを欲するいつの日かのために少し調べたので書き残しておきます。</p>
<div class="message">
先述の通りこのAPIはChrome87~以外の環境下では動作しません。本番環境で使って怒られても知りません
</div>
<h1>Quick Start</h1>
<h2>Origin Trialsでトークンを取得する</h2>
<p>Origin Trialsを利用したことがある方は飛ばして大丈夫です。<br>
まずは<a href="chrome://flags/#font-access">Chrome FlagsのFont Access API</a>をenableに変更します。その後<a href="https://developers.chrome.com/origintrials/#/view_trial/-7289075996899147775">Origin TrialsページのLocal Font Access</a>をRegisterします。するとトークンが発行されますので</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;origin-trial&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;ここにトークンを貼る&quot;</span>&gt;</span>
</code></pre>
<p>このmetaタグをソースコードに挿入します。</p>
<h2>APIが使えるかどうか</h2>
<p>まずこのAPIが使用できるかどうかを確認しておきましょう。</p>
<pre><code class="language-javascript"><span class="hljs-keyword">if</span>(!<span class="hljs-string">&#x27;fonts&#x27;</span> <span class="hljs-keyword">in</span> navigator) <span class="hljs-keyword">return</span>;
<span class="hljs-keyword">const</span> status = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">query</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;font-access&quot;</span> });
  <span class="hljs-keyword">if</span> (status.<span class="hljs-property">state</span> === <span class="hljs-string">&quot;granted&quot;</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission was granted 👍&quot;</span>);
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.<span class="hljs-property">state</span> === <span class="hljs-string">&quot;prompt&quot;</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission will be requested&quot;</span>);
  <span class="hljs-keyword">else</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission was denied 👎&quot;</span>);
</code></pre>
<p>Chrome87以上であれば問題ありませんがそうでないブラウザの場合は他の処理で代用するしかないでしょう。</p>
<h2>フォントオブジェクトを取得する</h2>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> iterableFontObject = navigator.<span class="hljs-property">fonts</span>.<span class="hljs-title function_">query</span>();
</code></pre>
<p>この変数には非同期イテレータ(<a href="https://ja.javascript.info/async-iterators-generators">Asynchronous Iterator</a>)が代入されます。つまり<code>for await of</code>でイテレート処理ができるわけです。</p>
<h2>メタデータを取得する</h2>
<pre><code class="language-javascript"><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> metadata <span class="hljs-keyword">of</span> iterableFontObject) {
  <span class="hljs-keyword">const</span> fontFamily = metadata.<span class="hljs-property">family</span>; <span class="hljs-comment">// e.g.ComicSansMS</span>
  <span class="hljs-keyword">const</span> postscriptName = metadata.<span class="hljs-property">postscriptName</span>; <span class="hljs-comment">// e.g.Comic Sans MS</span>
  <span class="hljs-keyword">const</span> fullName = metadata.<span class="hljs-property">fullName</span>; <span class="hljs-comment">// e.g.Comic Sans MS</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fontFamily, postscriptName, fullName);
}
</code></pre>
<p>現状文字列として取得できるデータはこの3つのようです。postscriptNameは確実にユニークで、OpenTypeフォーマットでなくてもUserAgentがよしなに導出してくれるようです。<br>
非同期イテレータは<code>Object.keys().length</code>ではフォント数の算出はできないので、イテレートついでに数えておくのが一番手っ取り早いかと。</p>
<h1>SFNTデータにアクセスする</h1>
<p><code>blob()</code>メソッドを使用すればsfntにフルアクセスすることが可能です。sfntデータにアクセスして何が嬉しいのかというとフォントのフォーマット、PostScript, TrueType, OpenType, WOFFなどが得られるというわけです。これに関してはまじで使い道が分からん。とりあえず実装していきます。</p>
<h2>SFNTバージョンを取得する</h2>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> fonts = navigator.<span class="hljs-property">fonts</span>.<span class="hljs-title function_">query</span>();
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> metadata <span class="hljs-keyword">of</span> fonts) {
  <span class="hljs-keyword">const</span> sfnt = <span class="hljs-keyword">await</span> metadata.<span class="hljs-title function_">blob</span>();
  <span class="hljs-keyword">const</span> sfntVersion = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>).<span class="hljs-title function_">decode</span>(
    <span class="hljs-keyword">await</span> sfnt.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>).<span class="hljs-title function_">arrayBuffer</span>()
  );
}
</code></pre>
<p><code>blob()</code>メソッドでBlob型のバイナリーデータを取得します。どうやらこのデータをデコードして、最初の4バイトを取得するとSFNTバージョンを取得できるらしいです。すげー。詳しくは<a href="https://docs.microsoft.com/en-us/typography/opentype/spec/otff#organization-of-an-opentype-font">MSの仕様書</a>をご覧ください。</p>
<p>ただこのままではなんのデータか分からないので拡張子形式に変換していきましょう。</p>
<pre><code class="language-javascript"><span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> metadata <span class="hljs-keyword">of</span> fonts) {
  <span class="hljs-keyword">let</span> outlineFormat = <span class="hljs-string">&#x27;UNKNOWN&#x27;</span>;
  <span class="hljs-keyword">switch</span> (sfntVersion) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;\x00\x01\x00\x00&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;true&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;typ1&#x27;</span>:
      outlineFormat = <span class="hljs-string">&#x27;.ttf&#x27;</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;OTTO&#x27;</span>:
      outlineFormat = <span class="hljs-string">&#x27;.cff&#x27;</span>;
      <span class="hljs-keyword">break</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Format Extension:&#x27;</span>, outlineFormat, metadata.<span class="hljs-property">family</span>);
}
</code></pre>
<p>現在AppleでサポートされているフォントはTrueType(.ttf)かPostscript(.cff)のどちらかなので、それに合わせてSFNTバージョンを絞っていきます。これまじで何に使うんだろうか。</p>
<h1>セキュリティの懸念と対策</h1>
<p>最近<a href="https://zenn.dev/kota_yata/articles/6baecf59f0b3a39ea5a6">File System Access API</a>などローカルのシステムにアクセスするAPIが増えていますが、やはり怖いのはセキュリティです。</p>
<h2>フィンガープリント対策</h2>
<p>Font Access APIは取得したフォントをアルファベット順にソートして返します。これは、システムにインストールされた順番のままフォントのリストを返してしまうと、フィンガープリントに利用され、ユーザーの識別に使われる可能性が高いからです。数百のフォントを全く同じ順番でインストールする複数のユーザーなどそういないですからね。</p>
<h2>リクエストシステム</h2>
<p>最初の方のパーミッションリクエストの部分がこれです。メタタグを使用してリクエストを送信しない限り使用できないようにすることでAPIの濫用を防いでいます。<br>
<a href="https://chromium.googlesource.com/chromium/src/+/lkgr/docs/security/permissions-for-powerful-web-platform-features.md">https://chromium.googlesource.com/chromium/src/+/lkgr/docs/security/permissions-for-powerful-web-platform-features.md</a></p>
<p>(この記事でも先述のFile System Access APIがケーススタディとして紹介されています)<br>
ただ、最初にメタタグなしでパーミッション確認もなしで実行してみたところ普通に動いてしまったので、筆者も???となっているところです。</p>
<h2>ユーザーの実行動作</h2>
<p>実はこのAPIは今までのコードを非同期即時関数に入れただけでは動きません。ロードしたら自動的に動作することを許可すると大抵良いことはないので、ボタンをクリックする、何かのキーを打つなどユーザーが自ら実行することでしか動かないような仕様になっています。(e.g.<code>~.addEventListner()</code>)</p>
<h2>確認ダイアログの表示</h2>
<p>このAPIを実行する動作をユーザーが行うと、<br>
<img src="https://storage.googleapis.com/zenn-user-upload/m5dz76ntrrdeq4zio8x31iyt8xao" alt="dialog"><br>
このダイアログが表示されます。これは他のローカルにアクセスするAPIでも同様の仕様のものが多いです。</p>
<h1>デモとソースコード</h1>
<p>ChromeのWebDevチームがGlitchにデモサイトとコードを公開しています。</p>
<p><a href="https://local-font-access.glitch.me/demo/">https://local-font-access.glitch.me/demo/</a></p>
<p>ほぼ似たようなものですが僕の書いたソースコードも投げておきます。</p>
<h4>Quick Startの方</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AccessFont</span> = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> status = <span class="hljs-keyword">await</span> navigator.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">query</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;font-access&quot;</span> });
  <span class="hljs-keyword">if</span> (status.<span class="hljs-property">state</span> === <span class="hljs-string">&quot;granted&quot;</span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission was granted 👍&quot;</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.<span class="hljs-property">state</span> === <span class="hljs-string">&quot;prompt&quot;</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission will be requested&quot;</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;permission was denied 👎&quot;</span>);
  }
  <span class="hljs-keyword">const</span> iterableFontObject = navigator.<span class="hljs-property">fonts</span>.<span class="hljs-title function_">query</span>();
  <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> metadata <span class="hljs-keyword">of</span> iterableFontObject) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(metadata.<span class="hljs-property">fullName</span>);
    total++;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Total number of local fonts : <span class="hljs-subst">${total}</span>`</span>);
}
<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;test&quot;</span>);
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-title class_">AccessFont</span>); <span class="hljs-comment">// ユーザーの動作がないと動かせない</span>
</code></pre>
<h4>SFNTアクセスの方</h4>
<pre><code class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Access</span>SFNT = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> fonts = navigator.<span class="hljs-property">fonts</span>.<span class="hljs-title function_">query</span>();
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> metadata <span class="hljs-keyword">of</span> fonts) {
    <span class="hljs-keyword">const</span> sfnt = <span class="hljs-keyword">await</span> metadata.<span class="hljs-title function_">blob</span>();
    <span class="hljs-keyword">const</span> sfntVersion = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>).<span class="hljs-title function_">decode</span>(
      <span class="hljs-keyword">await</span> sfnt.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>).<span class="hljs-title function_">arrayBuffer</span>()
    );
    <span class="hljs-keyword">let</span> outlineFormat = <span class="hljs-string">&#x27;UNKNOWN&#x27;</span>;
    <span class="hljs-keyword">switch</span> (sfntVersion) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;\x00\x01\x00\x00&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;true&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;typ1&#x27;</span>:
        outlineFormat = <span class="hljs-string">&#x27;.ttf&#x27;</span>;
	<span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;OTTO&#x27;</span>:
        outlineFormat = <span class="hljs-string">&#x27;.cff&#x27;</span>;
        <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Format Extension:&#x27;</span>, outlineFormat, metadata.<span class="hljs-property">family</span>);
  }
}
<span class="hljs-keyword">const</span> access = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;access&quot;</span>);
access.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-title class_">Access</span>SFNT); <span class="hljs-comment">// ユーザーの動作がないと動かせない</span>
</code></pre>
<h1>終わりに</h1>
<p>最初に記事を書いたときは本気で何に使うのか分からないAPIでしたが、どうやらFigmaとかその他デザインアプリケーション、CADに特化したフォントをWebで使う際に役立つようです。</p>
<blockquote>
<p>Bringing design apps like Figma, Gravit, and Photopea, to the web is great.<br>
For example, corporate logo fonts, or specialized fonts for CAD and other design applications.</p>
</blockquote>
<p><a href="https://developers.google.com/web/updates/2020/11/nic87#font-access">https://developers.google.com/web/updates/2020/11/nic87#font-access</a></p>
<h3>参考文献</h3>
<p><a href="https://wicg.github.io/local-font-access/#current-language">WICG仕様書</a></p>
<p><a href="https://web.dev/local-fonts/">Web.devチームブログ(最初に読むならこれ)</a></p>
<p><a href="https://glitch.com/~local-font-access">Web.devチームGlitchデモ</a></p>
<p><a href="https://developers.google.com/web/updates/2020/11/nic87">Chrome87の新機能まとめ(公式)</a></p>
<p><a href="https://www.chromestatus.com/feature/6234451761692672">Chrome Platform Status</a></p>
<p><a href="https://chromium.googlesource.com/chromium/src/+/lkgr/docs/security/permissions-for-powerful-web-platform-features.md">APIのパーミッションに関するChromeの文献</a></p>
<p><a href="https://nixeneko.hatenablog.com/entry/2018/06/20/000000">https://nixeneko.hatenablog.com/entry/2018/06/20/000000</a></p>
<!-- HTML_TAG_END -->
  <div class="share svelte-hf3o4"><a class="share-twitter svelte-hf3o4" target="blank"><img alt="Twitter share button" src="/twitter.svg" width="25px" height="25px"></a>
    <a class="share-pocket svelte-hf3o4" target="blank"><img alt="Pocket share button" src="/pocket.svg" width="25px" height="25px"></a>
    <a class="share-instapaper svelte-hf3o4" target="blank"><img alt="InstaPaper share button" src="/instapaper.svg" width="25px"></a></div></div>
</div></main>

<footer class="svelte-gbfwkw">@ 2021 Kota Yatagai</footer>



			<script type="application/json" data-type="svelte-data" data-url="/posts/faapi.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"meta\":{\"title\":\"ブラウザからローカルフォントを取得する\",\"date\":\"2020-11-25\",\"category\":\"Programming\",\"description\":\"Font Access APIでローカルにアクセス\",\"ogp\":\"\u002Fmedia\u002Ffaapi.webp\"},\"body\":\"\u003Cp\u003EChrome87よりブラウザ上でインストール済みのフォントを調べるFont Access APIがOrigin Trialsに公開されました。正直このAPIで何か作ろうとは思っていませんが、このAPIを欲するいつの日かのために少し調べたので書き残しておきます。\u003C\u002Fp\u003E\\n\u003Cdiv class=\\\"message\\\"\u003E\\n先述の通りこのAPIはChrome87~以外の環境下では動作しません。本番環境で使って怒られても知りません\\n\u003C\u002Fdiv\u003E\\n\u003Ch1\u003EQuick Start\u003C\u002Fh1\u003E\\n\u003Ch2\u003EOrigin Trialsでトークンを取得する\u003C\u002Fh2\u003E\\n\u003Cp\u003EOrigin Trialsを利用したことがある方は飛ばして大丈夫です。\u003Cbr\u003E\\nまずは\u003Ca href=\\\"chrome:\u002F\u002Fflags\u002F#font-access\\\"\u003EChrome FlagsのFont Access API\u003C\u002Fa\u003Eをenableに変更します。その後\u003Ca href=\\\"https:\u002F\u002Fdevelopers.chrome.com\u002Forigintrials\u002F#\u002Fview_trial\u002F-7289075996899147775\\\"\u003EOrigin TrialsページのLocal Font Access\u003C\u002Fa\u003EをRegisterします。するとトークンが発行されますので\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&lt;\u003Cspan class=\\\"hljs-name\\\"\u003Emeta\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ehttp-equiv\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;origin-trial&quot;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Econtent\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;ここにトークンを貼る&quot;\u003C\u002Fspan\u003E&gt;\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eこのmetaタグをソースコードに挿入します。\u003C\u002Fp\u003E\\n\u003Ch2\u003EAPIが使えるかどうか\u003C\u002Fh2\u003E\\n\u003Cp\u003EまずこのAPIが使用できるかどうかを確認しておきましょう。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E(!\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;fonts&#x27;\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Ein\u003C\u002Fspan\u003E navigator) \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E status = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Epermissions\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E({ \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;font-access&quot;\u003C\u002Fspan\u003E });\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E (status.\u003Cspan class=\\\"hljs-property\\\"\u003Estate\u003C\u002Fspan\u003E === \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;granted&quot;\u003C\u002Fspan\u003E)\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission was granted 👍&quot;\u003C\u002Fspan\u003E);\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E (status.\u003Cspan class=\\\"hljs-property\\\"\u003Estate\u003C\u002Fspan\u003E === \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;prompt&quot;\u003C\u002Fspan\u003E)\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission will be requested&quot;\u003C\u002Fspan\u003E);\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission was denied 👎&quot;\u003C\u002Fspan\u003E);\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EChrome87以上であれば問題ありませんがそうでないブラウザの場合は他の処理で代用するしかないでしょう。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eフォントオブジェクトを取得する\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E iterableFontObject = navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Efonts\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E();\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eこの変数には非同期イテレータ(\u003Ca href=\\\"https:\u002F\u002Fja.javascript.info\u002Fasync-iterators-generators\\\"\u003EAsynchronous Iterator\u003C\u002Fa\u003E)が代入されます。つまり\u003Ccode\u003Efor await of\u003C\u002Fcode\u003Eでイテレート処理ができるわけです。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eメタデータを取得する\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E (\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E metadata \u003Cspan class=\\\"hljs-keyword\\\"\u003Eof\u003C\u002Fspan\u003E iterableFontObject) {\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E fontFamily = metadata.\u003Cspan class=\\\"hljs-property\\\"\u003Efamily\u003C\u002Fspan\u003E; \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F e.g.ComicSansMS\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E postscriptName = metadata.\u003Cspan class=\\\"hljs-property\\\"\u003EpostscriptName\u003C\u002Fspan\u003E; \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F e.g.Comic Sans MS\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E fullName = metadata.\u003Cspan class=\\\"hljs-property\\\"\u003EfullName\u003C\u002Fspan\u003E; \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F e.g.Comic Sans MS\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(fontFamily, postscriptName, fullName);\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E現状文字列として取得できるデータはこの3つのようです。postscriptNameは確実にユニークで、OpenTypeフォーマットでなくてもUserAgentがよしなに導出してくれるようです。\u003Cbr\u003E\\n非同期イテレータは\u003Ccode\u003EObject.keys().length\u003C\u002Fcode\u003Eではフォント数の算出はできないので、イテレートついでに数えておくのが一番手っ取り早いかと。\u003C\u002Fp\u003E\\n\u003Ch1\u003ESFNTデータにアクセスする\u003C\u002Fh1\u003E\\n\u003Cp\u003E\u003Ccode\u003Eblob()\u003C\u002Fcode\u003Eメソッドを使用すればsfntにフルアクセスすることが可能です。sfntデータにアクセスして何が嬉しいのかというとフォントのフォーマット、PostScript, TrueType, OpenType, WOFFなどが得られるというわけです。これに関してはまじで使い道が分からん。とりあえず実装していきます。\u003C\u002Fp\u003E\\n\u003Ch2\u003ESFNTバージョンを取得する\u003C\u002Fh2\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E fonts = navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Efonts\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E();\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E (\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E metadata \u003Cspan class=\\\"hljs-keyword\\\"\u003Eof\u003C\u002Fspan\u003E fonts) {\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E sfnt = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E metadata.\u003Cspan class=\\\"hljs-title function_\\\"\u003Eblob\u003C\u002Fspan\u003E();\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E sfntVersion = (\u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title class_\\\"\u003ETextDecoder\u003C\u002Fspan\u003E).\u003Cspan class=\\\"hljs-title function_\\\"\u003Edecode\u003C\u002Fspan\u003E(\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E sfnt.\u003Cspan class=\\\"hljs-title function_\\\"\u003Eslice\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-number\\\"\u003E4\u003C\u002Fspan\u003E).\u003Cspan class=\\\"hljs-title function_\\\"\u003EarrayBuffer\u003C\u002Fspan\u003E()\\n  );\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Ccode\u003Eblob()\u003C\u002Fcode\u003EメソッドでBlob型のバイナリーデータを取得します。どうやらこのデータをデコードして、最初の4バイトを取得するとSFNTバージョンを取得できるらしいです。すげー。詳しくは\u003Ca href=\\\"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Ftypography\u002Fopentype\u002Fspec\u002Fotff#organization-of-an-opentype-font\\\"\u003EMSの仕様書\u003C\u002Fa\u003Eをご覧ください。\u003C\u002Fp\u003E\\n\u003Cp\u003Eただこのままではなんのデータか分からないので拡張子形式に変換していきましょう。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E (\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E metadata \u003Cspan class=\\\"hljs-keyword\\\"\u003Eof\u003C\u002Fspan\u003E fonts) {\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;UNKNOWN&#x27;\u003C\u002Fspan\u003E;\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eswitch\u003C\u002Fspan\u003E (sfntVersion) {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\\\\x00\\\\x01\\\\x00\\\\x00&#x27;\u003C\u002Fspan\u003E:\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;true&#x27;\u003C\u002Fspan\u003E:\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;typ1&#x27;\u003C\u002Fspan\u003E:\\n      outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;.ttf&#x27;\u003C\u002Fspan\u003E;\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E;\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;OTTO&#x27;\u003C\u002Fspan\u003E:\\n      outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;.cff&#x27;\u003C\u002Fspan\u003E;\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E;\\n  }\\n  \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Format Extension:&#x27;\u003C\u002Fspan\u003E, outlineFormat, metadata.\u003Cspan class=\\\"hljs-property\\\"\u003Efamily\u003C\u002Fspan\u003E);\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E現在AppleでサポートされているフォントはTrueType(.ttf)かPostscript(.cff)のどちらかなので、それに合わせてSFNTバージョンを絞っていきます。これまじで何に使うんだろうか。\u003C\u002Fp\u003E\\n\u003Ch1\u003Eセキュリティの懸念と対策\u003C\u002Fh1\u003E\\n\u003Cp\u003E最近\u003Ca href=\\\"https:\u002F\u002Fzenn.dev\u002Fkota_yata\u002Farticles\u002F6baecf59f0b3a39ea5a6\\\"\u003EFile System Access API\u003C\u002Fa\u003EなどローカルのシステムにアクセスするAPIが増えていますが、やはり怖いのはセキュリティです。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eフィンガープリント対策\u003C\u002Fh2\u003E\\n\u003Cp\u003EFont Access APIは取得したフォントをアルファベット順にソートして返します。これは、システムにインストールされた順番のままフォントのリストを返してしまうと、フィンガープリントに利用され、ユーザーの識別に使われる可能性が高いからです。数百のフォントを全く同じ順番でインストールする複数のユーザーなどそういないですからね。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eリクエストシステム\u003C\u002Fh2\u003E\\n\u003Cp\u003E最初の方のパーミッションリクエストの部分がこれです。メタタグを使用してリクエストを送信しない限り使用できないようにすることでAPIの濫用を防いでいます。\u003Cbr\u003E\\n\u003Ca href=\\\"https:\u002F\u002Fchromium.googlesource.com\u002Fchromium\u002Fsrc\u002F+\u002Flkgr\u002Fdocs\u002Fsecurity\u002Fpermissions-for-powerful-web-platform-features.md\\\"\u003Ehttps:\u002F\u002Fchromium.googlesource.com\u002Fchromium\u002Fsrc\u002F+\u002Flkgr\u002Fdocs\u002Fsecurity\u002Fpermissions-for-powerful-web-platform-features.md\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E(この記事でも先述のFile System Access APIがケーススタディとして紹介されています)\u003Cbr\u003E\\nただ、最初にメタタグなしでパーミッション確認もなしで実行してみたところ普通に動いてしまったので、筆者も???となっているところです。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eユーザーの実行動作\u003C\u002Fh2\u003E\\n\u003Cp\u003E実はこのAPIは今までのコードを非同期即時関数に入れただけでは動きません。ロードしたら自動的に動作することを許可すると大抵良いことはないので、ボタンをクリックする、何かのキーを打つなどユーザーが自ら実行することでしか動かないような仕様になっています。(e.g.\u003Ccode\u003E~.addEventListner()\u003C\u002Fcode\u003E)\u003C\u002Fp\u003E\\n\u003Ch2\u003E確認ダイアログの表示\u003C\u002Fh2\u003E\\n\u003Cp\u003EこのAPIを実行する動作をユーザーが行うと、\u003Cbr\u003E\\n\u003Cimg src=\\\"https:\u002F\u002Fstorage.googleapis.com\u002Fzenn-user-upload\u002Fm5dz76ntrrdeq4zio8x31iyt8xao\\\" alt=\\\"dialog\\\"\u003E\u003Cbr\u003E\\nこのダイアログが表示されます。これは他のローカルにアクセスするAPIでも同様の仕様のものが多いです。\u003C\u002Fp\u003E\\n\u003Ch1\u003Eデモとソースコード\u003C\u002Fh1\u003E\\n\u003Cp\u003EChromeのWebDevチームがGlitchにデモサイトとコードを公開しています。\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Flocal-font-access.glitch.me\u002Fdemo\u002F\\\"\u003Ehttps:\u002F\u002Flocal-font-access.glitch.me\u002Fdemo\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Eほぼ似たようなものですが僕の書いたソースコードも投げておきます。\u003C\u002Fp\u003E\\n\u003Ch4\u003EQuick Startの方\u003C\u002Fh4\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title class_\\\"\u003EAccessFont\u003C\u002Fspan\u003E = \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E status = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Epermissions\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E({ \u003Cspan class=\\\"hljs-attr\\\"\u003Ename\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;font-access&quot;\u003C\u002Fspan\u003E });\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E (status.\u003Cspan class=\\\"hljs-property\\\"\u003Estate\u003C\u002Fspan\u003E === \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;granted&quot;\u003C\u002Fspan\u003E){\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission was granted 👍&quot;\u003C\u002Fspan\u003E);\\n  } \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E (status.\u003Cspan class=\\\"hljs-property\\\"\u003Estate\u003C\u002Fspan\u003E === \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;prompt&quot;\u003C\u002Fspan\u003E) {\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission will be requested&quot;\u003C\u002Fspan\u003E);\\n  } \u003Cspan class=\\\"hljs-keyword\\\"\u003Eelse\u003C\u002Fspan\u003E {\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;permission was denied 👎&quot;\u003C\u002Fspan\u003E);\\n  }\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E iterableFontObject = navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Efonts\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E();\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E total = \u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E;\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E (\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E metadata \u003Cspan class=\\\"hljs-keyword\\\"\u003Eof\u003C\u002Fspan\u003E iterableFontObject) {\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(metadata.\u003Cspan class=\\\"hljs-property\\\"\u003EfullName\u003C\u002Fspan\u003E);\\n    total++;\\n  }\\n  \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E`Total number of local fonts : \u003Cspan class=\\\"hljs-subst\\\"\u003E${total}\u003C\u002Fspan\u003E`\u003C\u002Fspan\u003E);\\n}\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E button = \u003Cspan class=\\\"hljs-variable language_\\\"\u003Edocument\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003EgetElementById\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;test&quot;\u003C\u002Fspan\u003E);\\nbutton.\u003Cspan class=\\\"hljs-title function_\\\"\u003EaddEventListener\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;click&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-title class_\\\"\u003EAccessFont\u003C\u002Fspan\u003E); \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F ユーザーの動作がないと動かせない\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch4\u003ESFNTアクセスの方\u003C\u002Fh4\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-javascript\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title class_\\\"\u003EAccess\u003C\u002Fspan\u003ESFNT = \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E () =&gt; {\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E fonts = navigator.\u003Cspan class=\\\"hljs-property\\\"\u003Efonts\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Equery\u003C\u002Fspan\u003E();\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E (\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E metadata \u003Cspan class=\\\"hljs-keyword\\\"\u003Eof\u003C\u002Fspan\u003E fonts) {\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E sfnt = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E metadata.\u003Cspan class=\\\"hljs-title function_\\\"\u003Eblob\u003C\u002Fspan\u003E();\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E sfntVersion = (\u003Cspan class=\\\"hljs-keyword\\\"\u003Enew\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title class_\\\"\u003ETextDecoder\u003C\u002Fspan\u003E).\u003Cspan class=\\\"hljs-title function_\\\"\u003Edecode\u003C\u002Fspan\u003E(\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E sfnt.\u003Cspan class=\\\"hljs-title function_\\\"\u003Eslice\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-number\\\"\u003E0\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-number\\\"\u003E4\u003C\u002Fspan\u003E).\u003Cspan class=\\\"hljs-title function_\\\"\u003EarrayBuffer\u003C\u002Fspan\u003E()\\n    );\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;UNKNOWN&#x27;\u003C\u002Fspan\u003E;\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eswitch\u003C\u002Fspan\u003E (sfntVersion) {\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\\\\x00\\\\x01\\\\x00\\\\x00&#x27;\u003C\u002Fspan\u003E:\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;true&#x27;\u003C\u002Fspan\u003E:\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;typ1&#x27;\u003C\u002Fspan\u003E:\\n        outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;.ttf&#x27;\u003C\u002Fspan\u003E;\\n\\t\u003Cspan class=\\\"hljs-keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E;\\n      \u003Cspan class=\\\"hljs-keyword\\\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;OTTO&#x27;\u003C\u002Fspan\u003E:\\n        outlineFormat = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;.cff&#x27;\u003C\u002Fspan\u003E;\\n        \u003Cspan class=\\\"hljs-keyword\\\"\u003Ebreak\u003C\u002Fspan\u003E;\\n    }\\n    \u003Cspan class=\\\"hljs-variable language_\\\"\u003Econsole\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003Elog\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Format Extension:&#x27;\u003C\u002Fspan\u003E, outlineFormat, metadata.\u003Cspan class=\\\"hljs-property\\\"\u003Efamily\u003C\u002Fspan\u003E);\\n  }\\n}\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E access = \u003Cspan class=\\\"hljs-variable language_\\\"\u003Edocument\u003C\u002Fspan\u003E.\u003Cspan class=\\\"hljs-title function_\\\"\u003EgetElementById\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;access&quot;\u003C\u002Fspan\u003E);\\naccess.\u003Cspan class=\\\"hljs-title function_\\\"\u003EaddEventListener\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;click&quot;\u003C\u002Fspan\u003E, \u003Cspan class=\\\"hljs-title class_\\\"\u003EAccess\u003C\u002Fspan\u003ESFNT); \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F ユーザーの動作がないと動かせない\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch1\u003E終わりに\u003C\u002Fh1\u003E\\n\u003Cp\u003E最初に記事を書いたときは本気で何に使うのか分からないAPIでしたが、どうやらFigmaとかその他デザインアプリケーション、CADに特化したフォントをWebで使う際に役立つようです。\u003C\u002Fp\u003E\\n\u003Cblockquote\u003E\\n\u003Cp\u003EBringing design apps like Figma, Gravit, and Photopea, to the web is great.\u003Cbr\u003E\\nFor example, corporate logo fonts, or specialized fonts for CAD and other design applications.\u003C\u002Fp\u003E\\n\u003C\u002Fblockquote\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fdevelopers.google.com\u002Fweb\u002Fupdates\u002F2020\u002F11\u002Fnic87#font-access\\\"\u003Ehttps:\u002F\u002Fdevelopers.google.com\u002Fweb\u002Fupdates\u002F2020\u002F11\u002Fnic87#font-access\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Ch3\u003E参考文献\u003C\u002Fh3\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fwicg.github.io\u002Flocal-font-access\u002F#current-language\\\"\u003EWICG仕様書\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fweb.dev\u002Flocal-fonts\u002F\\\"\u003EWeb.devチームブログ(最初に読むならこれ)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fglitch.com\u002F~local-font-access\\\"\u003EWeb.devチームGlitchデモ\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fdevelopers.google.com\u002Fweb\u002Fupdates\u002F2020\u002F11\u002Fnic87\\\"\u003EChrome87の新機能まとめ(公式)\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fwww.chromestatus.com\u002Ffeature\u002F6234451761692672\\\"\u003EChrome Platform Status\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fchromium.googlesource.com\u002Fchromium\u002Fsrc\u002F+\u002Flkgr\u002Fdocs\u002Fsecurity\u002Fpermissions-for-powerful-web-platform-features.md\\\"\u003EAPIのパーミッションに関するChromeの文献\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fnixeneko.hatenablog.com\u002Fentry\u002F2018\u002F06\u002F20\u002F000000\\\"\u003Ehttps:\u002F\u002Fnixeneko.hatenablog.com\u002Fentry\u002F2018\u002F06\u002F20\u002F000000\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\"}"}</script>
		</div>
	</body>
</html>
