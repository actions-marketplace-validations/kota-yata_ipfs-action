<!DOCTYPE html>
<html lang="en">
	<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KOTA YATAGAI | 八谷航太</title>
    <title>毎朝5時にGoogle Formに自動回答したい</title><meta name="description" content="SeleniumとLambdaを使った自動化の記事" data-svelte="svelte-189on1m"><meta property="og:url" content="https://kota-yata.com" data-svelte="svelte-189on1m"><meta property="og:title" content="毎朝5時にGoogle Formに自動回答したい" data-svelte="svelte-189on1m"><meta property="og:image" content="https://kota-yata.com/media/gfa.webp" data-svelte="svelte-189on1m"><meta property="og:description" content="SeleniumとLambdaを使った自動化の記事" data-svelte="svelte-189on1m"><meta name="twitter:card" content="summary_large_image" data-svelte="svelte-189on1m"><meta name="twitter:site" content="@kota_yata" data-svelte="svelte-189on1m">

		

		<link rel="modulepreload" href="/_app/start-daaae108.js">
		<link rel="modulepreload" href="/_app/chunks/vendor-495f2134.js">
		<link rel="modulepreload" href="/_app/pages/__layout.svelte-be316660.js">
		<link rel="modulepreload" href="/_app/chunks/index-6747d163.js">
		<link rel="modulepreload" href="/_app/pages/posts/_path_.svelte-2d94d26d.js">
		<link rel="modulepreload" href="/_app/chunks/page-7b278a70.js">
		<link rel="modulepreload" href="/_app/chunks/className-0b25377b.js">
		<link rel="stylesheet" href="/_app/assets/start-61d1577b.css">
		<link rel="stylesheet" href="/_app/assets/pages/__layout.svelte-0136ed43.css">
		<link rel="stylesheet" href="/_app/assets/app-d7359544.css">
		<link rel="stylesheet" href="/_app/assets/pages/posts/_path_.svelte-77f41461.css">
		<link rel="stylesheet" href="/_app/assets/page-da0bc829.css">

		<script type="module">
			import { start } from "/_app/start-daaae108.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-be316660.js"),
						import("/_app/pages/posts/_path_.svelte-2d94d26d.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "\u002Fposts\u002Fgfa",
						query: new URLSearchParams(""),
						params: {path:"gfa"}
					}
				}
			});
		</script>
    <meta name="keyword" content="kota,yatagai,kota yatagai,八谷航太">
    <link rel="icon" href="/me.webp" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link defer
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
      rel="stylesheet">
    <link defer rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
      integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
    <link defer rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/a11y-dark.min.css"
      integrity="sha384-Mt8bPDNu0L2sVzon3+a8Rqtl4fmqaUmTPBEd/DTHiGFEQEFvf0fYLnU1DgK+ER2h" crossorigin="anonymous">
	</head>
	<body>
		<div id="svelte">


<header class="svelte-gbfwkw"><div class="left svelte-gbfwkw"><a href="/" class="svelte-gbfwkw">KOTA YATAGAI</a></div>
  <div class="right svelte-gbfwkw"><select name="language"><option value="JP">Japanese</option><option value="EN">English</option></select>
    <a href="/trip" sveltekit:prefetch class="svelte-gbfwkw"><img alt="to trip page" src="/airplane.svg" width="30px" height="30px"></a></div></header>

<main class="svelte-gbfwkw">
  

<div class="container svelte-izy1ym"><div class="profile svelte-izy1ym"><div class="container svelte-g32fgp"><img alt="myself" src="/me.webp" width="150px" height="150px" class="svelte-g32fgp">
  <div class="bio svelte-g32fgp"><h4 class="svelte-g32fgp">八谷航太</h4>
    <p class="svelte-g32fgp">18yo / ソフトウェア開発者</p></div>
  <ul class="svelte-g32fgp"><li class="svelte-g32fgp"><a href="/" class="svelte-g32fgp">Home</a></li><li class="svelte-g32fgp"><a href="/about" class="svelte-g32fgp">About</a></li><li class="svelte-g32fgp"><a href="/works" class="svelte-g32fgp">Works</a></li><li class="svelte-g32fgp"><a href="/contacts" class="svelte-g32fgp">Contacts</a></li></ul>
  <div class="icons svelte-g32fgp"><a href="https://github.com/kota-yata" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/github.svg" width="20px" height="20px"></a><a href="https://open.spotify.com/user/jgm80x9h1j84hnk4nv3hozlaf" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/spotify.svg" width="20px" height="20px"></a><a href="https://twitter.com/kota_yata" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/twitter.svg" width="20px" height="20px"></a><a href="https://speakerdeck.com/kota_yata/" sveltekit:prefetch class="svelte-g32fgp"><img alt="icon" src="/speakerdeck.svg" width="20px" height="20px"></a></div>
</div></div>
  <div class="slot svelte-izy1ym"><div class="info svelte-hf3o4"><h1 class="info-title svelte-hf3o4">毎朝5時にGoogle Formに自動回答したい</h1>
    <span class="info-date svelte-hf3o4">2020-08-11</span>
    <span class="info-category programming svelte-hf3o4">Programming</span></div>
  <!-- HTML_TAG_START --><p>みなさんこんにちは。夏ですね。<br>
僕もついに部活動が再開し、ワクワクドキドキな訳ですが、一昨日の夜顧問からこんな連絡がきました。</p>
<pre><code>- 毎朝5時20分までに検温を行い、結果をGoogleFormから報告してください
- 報告がなかった部員は朝練の参加を認めません
</code></pre>
<p>そもそも朝練が6時半から始まる時点でイッているので5時20分に連絡しろと言われてもさほど驚かなかったのですが、ここで一つ問題が発生しました。</p>
<p>というのも僕は普段朝5時に起き、そのままパンをかじりながら自転車で駅に向かうので、検温をする時間がないのです。もう少し早起きすれば済む話なのですが、4時起きは流石にきついし体がもたないのでやりたくない。かといって5時に起きて検温なんかしていたら朝練そのものに遅れてしまう。</p>
<p>というわけで、朝5時くらいに、心配されない程度の体温をよしなに指定のFormに入力して送信してくれるプログラムを作りたいと思います。</p>
<h2>Seleniumでフォームを送信する</h2>
<p>本物のフォームを使ってやると僕の身元がバレてしまうので、今回は<a href="https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform">テスト用に僕が作成した本物と同じ内容のフォーム</a>で実装したいと思います。</p>
<h3>初期値入力つきURLを用意する</h3>
<p>Google Formは、パラメータをつけることで各質問の値を入力した状態でURLを開くことができます。<br>
普通にフォームを開く際のURLは</p>
<p><a href="https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=sf_link">https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=sf_link</a></p>
<p>こんな感じでviewformの後に「usp=sf_link」というパラメータがついています。このパラメータは事前入力のない、ピュアな回答フォームであることを示しているので、まずここを「usp=pp_url」に変えて、事前入力があることを知らせてあげます。<br>
 <br>
 <br>
そしたら次に各質問の回答をパラメータに入力していきます。フォームの各質問を識別する番号があるので、Chromeの検証画面で質問のdivを探し、2階層目で以下のような番号を探します。<br>
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/502570/d48564de-3d9c-07e0-7aec-755e1b4444d5.jpeg" alt="スクリーンショット 2020-08-07 16.56.07.jpg"><br>
番号を見つけたら<code>entry.番号=回答内容</code>の形でパラメータを加えます。今回は名前と体温をテキストで入力するので以下のようなURLになります。</p>
<p><a href="https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=pp_url&amp;entry.1534939278=%E8%8D%92%E5%B7%9D%E6%99%BA%E5%89%87&amp;entry.511939456=36.5">https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=36.5</a><br>
しかしこのままだと毎日36.5度を報告することになり、流石に怪しまれるので、乱数で良い感じに値を振ります。</p>
<pre><code class="language-python"><span class="hljs-comment"># 36.1~36.7の間でランダムに値を生成して文字列変換</span>
body_temp = <span class="hljs-built_in">str</span>(<span class="hljs-number">36</span> + random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>)/<span class="hljs-number">10</span>)
<span class="hljs-comment"># URLの最後に加える</span>
url = <span class="hljs-string">&#x27;https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;</span>+body_temp
</code></pre>
<h3>Seleniumで自動提出</h3>
<p>URLが完成したら、あとはSeleniumでURLを開き、ポチッと提出ボタンを押してもらうだけです。</p>
<pre><code class="language-python"><span class="hljs-comment"># SeleniumとChromedriverをpipでインストールしておく</span>
<span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">import</span> chromedriver_binary
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random

body_temp = <span class="hljs-built_in">str</span>(<span class="hljs-number">36</span> + random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>)/<span class="hljs-number">10</span>)
url = <span class="hljs-string">&#x27;https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;</span>+body_temp

<span class="hljs-comment"># クリックの関数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">click</span>(<span class="hljs-params">xpath</span>):
    driver.find_element_by_xpath(xpath).click()

<span class="hljs-comment"># パスワード入力の関数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_pw</span>(<span class="hljs-params">xpath, <span class="hljs-built_in">str</span></span>):
    driver.find_element_by_xpath(xpath).send_keys(<span class="hljs-built_in">str</span>)

driver = webdriver.Chrome()
driver.implicitly_wait(<span class="hljs-number">1</span>)
driver.get(url)

moving_login_button = <span class="hljs-string">&#x27;/html/body/div[2]/div/div[2]/div[3]/div[2]&#x27;</span>
time.sleep(<span class="hljs-number">1</span>)

<span class="hljs-comment"># Googleアカウントでのログインが必要な場合はログインする</span>
<span class="hljs-keyword">if</span>(driver.find_elements_by_xpath(moving_login_button) != []):
  click(moving_login_button)
  login_id = <span class="hljs-string">&quot;{Googleアカウントのメアド}&quot;</span>
  login_id_xpath = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[1]/div/form/span/section/div/div/div[1]/div/div[1]/div/div[1]/input&#x27;</span>
  login_id_button = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[2]/div/div[1]/div/div&#x27;</span>
  insert_pw(login_id_xpath, login_id)
  click(login_id_button)
  time.sleep(<span class="hljs-number">1</span>)
  login_pw = <span class="hljs-string">&quot;{Googleアカウントのパスワード}&quot;</span>
  login_pw_xpath = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[1]/div/form/span/section/div/div/div[1]/div[1]/div/div/div/div/div[1]/div/div[1]/input&#x27;</span>
  login_pw_button = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[2]/div/div[1]/div/div&#x27;</span>
  insert_pw(login_pw_xpath, login_pw)
  time.sleep(<span class="hljs-number">1</span>)
  click(login_pw_button)

time.sleep(<span class="hljs-number">1</span>)
submit_button = <span class="hljs-string">&#x27;//*[@id=&quot;mG61Hd&quot;]/div[2]/div/div[3]/div[1]/div/div&#x27;</span>
click(submit_button)

<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done!&quot;</span>)

driver.close
<span class="hljs-comment"># メモリーを食うのでちゃんと終了しましょう</span>
driver.quit
</code></pre>
<p><img src="/media/gfa.webp" alt="img"></p>
<p>しっかり送信できました。</p>
<h2>定期イベントにする</h2>
<p>コードが書けたらあとは定期イベント化するだけなのですが、ここで少しつまづいたのでやり方を説明しておきます。<br>
 <br>
 <br>
当初予定していた方法としてはAutomatorでアプリ化し、カレンダーに入れて毎日実行する方法(<a href="https://qiita.com/baraobara/items/73d753c678e5c0e72f46#4-mac%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AEautomator%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6mac%E5%86%85%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B">参考</a>)。これなら報告しなくて良い日はカレンダーから外せば良いし、完璧なはず。と思ったのですが、PCをシャットダウンしていると動作しないためボツ。crontabに設定して定期イベント化する方法も同様の理由でボツ。</p>
<p>結局臨機応変にイベントの変更はできないものの、PCの状態にかかわらず実行してくれるAWSのLambdaを使用することに決めました。(Lambdaの使い方は<a href="https://www.wakuwakubank.com/posts/519-aws-lambda-introduction/">このサイト</a>とかが参考になりました)</p>
<h3>LambdaのレイヤーにSeleniumとChromedriver、headless-chromiumを上げる</h3>
<p>Lambdaでライブラリを使うには各フォルダをzipに圧縮してレイヤーにアップロードする必要があります。今回はSeleniumとChromeのWebdriverであるChromedriver、それからChromeを開かずにスクレイピングを行うためのheadless-chromiumを使用するので、それぞれzipに圧縮してレイヤーに上げていきます。</p>
<h4>1. Selenium</h4>
<pre><code>mkdir selenium
cd selenium
mkdir python
cd python
pip install selenium -t .
cd ../
zip -r selenium.zip ./python
</code></pre>
<p>できたzipファイルをそのままレイヤーにアップロードします。</p>
<h4>2. Chromedriverとheadless-chromium</h4>
<pre><code>curl https://github.com/adieuadieu/serverless-chrome/releases/download/v1.0.0-55/stable-headless-chromium-amazonlinux-2017-03.zip &gt; headless-chromium.zip
curl https://chromedriver.storage.googleapis.com/2.43/chromedriver_linux64.zip &gt; chromedriver.zip
</code></pre>
<p>できた二つのzipファイルを解凍し、headless-chromeフォルダにまとめます。その後そのheadless-chromeをzipに圧縮してレイヤーにアップロードします。</p>
<h4>3. レイヤーを関数に適用</h4>
<p>関数の下にある「Layers」を押し、下の「レイヤーの追加」ボタンから二つのレイヤを追加します<br>
<img width="1612" alt="スクリーンショット 2020-08-07 18.36.45.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/502570/27d63d99-6a12-7370-3e32-46851977176f.png"></p>
<h4>※注意※</h4>
<ul>
<li>Lambda関数のランタイムをPython3.8にするとChromedriverが動いてくれなかった(原因不明)ので、ランタイムはPython3.6か3.7に設定することをお勧めします。</li>
<li>headless-chromiumとChromedriverの間に互換性がないと動作しないので<a href="http://chromedriver.chromium.org/downloads">こちら</a>から最新版を入手しても動作しない可能性があります。</li>
</ul>
<h3>Lambda用にコードを少し変える</h3>
<p>筆者は今までCloud9以外のAWSツールを使ったことがないへっぽこコーダーなので、色んなサイトの見様見真似でなんとかLambdaで動くコードにしました。先人に感謝。</p>
<pre><code class="language-python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lambda_handler</span>(<span class="hljs-params">event, context</span>):
    body_temp = <span class="hljs-built_in">str</span>(<span class="hljs-number">36</span> + random.randint(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>)/<span class="hljs-number">10</span>)
    url = <span class="hljs-string">&#x27;https://docs.google.com/forms/d/e/1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog/viewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;</span>+body_temp
    options = webdriver.ChromeOptions()
    options.binary_location = <span class="hljs-string">&#x27;/opt/headless-chrome/headless-chromium&#x27;</span>
    <span class="hljs-comment"># このオプション4つを付けないとChromeは起動せずエラーになります</span>
    options.add_argument(<span class="hljs-string">&#x27;--headless&#x27;</span>) <span class="hljs-comment"># サーバーレスでChromeを起動</span>
    options.add_argument(<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>) <span class="hljs-comment"># sandbox外でChromeを起動</span>
    options.add_argument(<span class="hljs-string">&#x27;--single-process&#x27;</span>) <span class="hljs-comment"># タブ/サイトごとのマルチプロセスではなく、シングルプロセスへ切り替える</span>
    options.add_argument(<span class="hljs-string">&#x27;--disable-dev-shm-usage&#x27;</span>) <span class="hljs-comment"># メモリファイルの出力場所を変える</span>
    driver = webdriver.Chrome(<span class="hljs-string">&#x27;/opt/headless-chrome/chromedriver&#x27;</span>,options = options)
    driver.implicitly_wait(<span class="hljs-number">1</span>)
    driver.get(url)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">click</span>(<span class="hljs-params">xpath</span>):
        driver.find_element_by_xpath(xpath).click()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_pw</span>(<span class="hljs-params">xpath, <span class="hljs-built_in">str</span></span>):
        driver.find_element_by_xpath(xpath).send_keys(<span class="hljs-built_in">str</span>)
    
    moving_login_button = <span class="hljs-string">&#x27;/html/body/div[2]/div/div[2]/div[3]/div[2]&#x27;</span>
    time.sleep(<span class="hljs-number">2</span>)
    <span class="hljs-keyword">if</span>(driver.find_elements_by_xpath(moving_login_button) != []):
        click(moving_login_button)
        <span class="hljs-comment"># 環境変数でMY_GMAILにGoogleアカウントのメアドを設定してください</span>
        login_id = MY_GMAIL
        login_id_xpath = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[1]/div/form/span/section/div/div/div[1]/div/div[1]/div/div[1]/input&#x27;</span>
        login_id_button = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[2]/div/div[1]/div/div&#x27;</span>
        insert_pw(login_id_xpath, login_id)
        click(login_id_button)
        time.sleep(<span class="hljs-number">1</span>)
        <span class="hljs-comment"># 環境変数でMY_PASSWORDにGoogleアカウントのパスワードを設定してください</span>
        login_pw = MY_PASSWORD
        login_pw_xpath = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[1]/div/form/span/section/div/div/div[1]/div[1]/div/div/div/div/div[1]/div/div[1]/input&#x27;</span>
        login_pw_button = <span class="hljs-string">&#x27;/html/body/div[1]/div[1]/div[2]/div/div[2]/div/div/div[2]/div/div[2]/div/div[1]/div/div&#x27;</span>
        insert_pw(login_pw_xpath, login_pw)
        time.sleep(<span class="hljs-number">1</span>)
        click(login_pw_button)
    time.sleep(<span class="hljs-number">1</span>)
    submit_button = <span class="hljs-string">&#x27;//*[@id=&quot;mG61Hd&quot;]/div[2]/div/div[3]/div[1]/div/div&#x27;</span>
    click(submit_button)
    driver.close
    driver.quit
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&#x27;statusCode&#x27;</span>: <span class="hljs-number">200</span>,
        <span class="hljs-string">&#x27;body&#x27;</span>: json.dumps(<span class="hljs-string">&#x27;Form submission success!!&#x27;</span>)
    }

</code></pre>
<h4>注意点</h4>
<ul>
<li>Chromeの起動オプション<code>--headless</code>,<code>--no-sandbox</code>,<code>single-process</code>,<code>--disable-dev-shm-usage</code>を付けないとLambda上で正常に起動せず、エラーが出ます。各オプションについての詳細は<a href="http://chrome.half-moon.org/43.html">こちら</a>をご覧ください</li>
<li>レイヤーにアップロードしたファイルはoptディレクトリの配下に置かれます。パスを指定する際はopt/ディレクトリ名/…の形で表記しましょう</li>
</ul>
<h3>CloudWatch Eventsでトリガーを設定</h3>
<ol>
<li>関数の「Layers」をクリックして「トリガーを追加をクリック」し、ドロップダウンから「EventBridge (CloudWatch Events)」を選択します。</li>
<li>ルールは「新規ルールの作成」で任意のルール名を入力。ルールタイプをスケジュール式にし、今回は毎日朝5時なので<code>corn(0 20 ? * * *)</code>と入力(LambdaはUTCでトリガーされるので9時間前をセットすることに留意)。トリガーを有効にして「追加」をクリックします。（cronの書き方は<a href="https://qiita.com/tossh/items/e135bd063a50087c3d6a">こちら</a>をご覧ください）</li>
</ol>
<img width="810" alt="スクリーンショット 2020-08-07 18.56.44.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/502570/2c07b4d3-295d-7543-7de7-dc8b0efaf40b.png">
<h2>テスト</h2>
<p>最後にしっかり動くかテストしましょう。Lambda関数画面の「テスト」をクリックします。<br>
<img width="1613" alt="スクリーンショット 2020-08-07 18.51.28.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/502570/8418067e-0784-9b2c-feeb-624c132e277d.png"><br>
大丈夫そうですね。</p>
<h2>おわりに</h2>
<p>朝の検温はサボっていますが、寝る前にちゃんと測っているので安心してください。</p>
<h2>参考文献</h2>
<p><a href="https://masakimisawa.com/selenium_headless-chrome_python_on_lambda/">https://masakimisawa.com/selenium_headless-chrome_python_on_lambda/</a><br>
<a href="https://github.com/heroku/heroku-buildpack-google-chrome/issues/56">https://github.com/heroku/heroku-buildpack-google-chrome/issues/56</a><br>
<a href="https://qiita.com/mishimay/items/afd7f247f101fbe25f30">https://qiita.com/mishimay/items/afd7f247f101fbe25f30</a></p>
<!-- HTML_TAG_END -->
  <div class="share svelte-hf3o4"><a class="share-twitter svelte-hf3o4" target="blank"><img alt="Twitter share button" src="/twitter.svg" width="25px" height="25px"></a>
    <a class="share-pocket svelte-hf3o4" target="blank"><img alt="Pocket share button" src="/pocket.svg" width="25px" height="25px"></a>
    <a class="share-instapaper svelte-hf3o4" target="blank"><img alt="InstaPaper share button" src="/instapaper.svg" width="25px"></a></div></div>
</div></main>

<footer class="svelte-gbfwkw">@ 2021 Kota Yatagai</footer>



			<script type="application/json" data-type="svelte-data" data-url="/posts/gfa.json">{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"meta\":{\"title\":\"毎朝5時にGoogle Formに自動回答したい\",\"date\":\"2020-08-11\",\"category\":\"Programming\",\"description\":\"SeleniumとLambdaを使った自動化の記事\",\"ogp\":\"\u002Fmedia\u002Fgfa.webp\"},\"body\":\"\u003Cp\u003Eみなさんこんにちは。夏ですね。\u003Cbr\u003E\\n僕もついに部活動が再開し、ワクワクドキドキな訳ですが、一昨日の夜顧問からこんな連絡がきました。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode\u003E- 毎朝5時20分までに検温を行い、結果をGoogleFormから報告してください\\n- 報告がなかった部員は朝練の参加を認めません\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eそもそも朝練が6時半から始まる時点でイッているので5時20分に連絡しろと言われてもさほど驚かなかったのですが、ここで一つ問題が発生しました。\u003C\u002Fp\u003E\\n\u003Cp\u003Eというのも僕は普段朝5時に起き、そのままパンをかじりながら自転車で駅に向かうので、検温をする時間がないのです。もう少し早起きすれば済む話なのですが、4時起きは流石にきついし体がもたないのでやりたくない。かといって5時に起きて検温なんかしていたら朝練そのものに遅れてしまう。\u003C\u002Fp\u003E\\n\u003Cp\u003Eというわけで、朝5時くらいに、心配されない程度の体温をよしなに指定のFormに入力して送信してくれるプログラムを作りたいと思います。\u003C\u002Fp\u003E\\n\u003Ch2\u003ESeleniumでフォームを送信する\u003C\u002Fh2\u003E\\n\u003Cp\u003E本物のフォームを使ってやると僕の身元がバレてしまうので、今回は\u003Ca href=\\\"https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform\\\"\u003Eテスト用に僕が作成した本物と同じ内容のフォーム\u003C\u002Fa\u003Eで実装したいと思います。\u003C\u002Fp\u003E\\n\u003Ch3\u003E初期値入力つきURLを用意する\u003C\u002Fh3\u003E\\n\u003Cp\u003EGoogle Formは、パラメータをつけることで各質問の値を入力した状態でURLを開くことができます。\u003Cbr\u003E\\n普通にフォームを開く際のURLは\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=sf_link\\\"\u003Ehttps:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=sf_link\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Eこんな感じでviewformの後に「usp=sf_link」というパラメータがついています。このパラメータは事前入力のない、ピュアな回答フォームであることを示しているので、まずここを「usp=pp_url」に変えて、事前入力があることを知らせてあげます。\u003Cbr\u003E\\n \u003Cbr\u003E\\n \u003Cbr\u003E\\nそしたら次に各質問の回答をパラメータに入力していきます。フォームの各質問を識別する番号があるので、Chromeの検証画面で質問のdivを探し、2階層目で以下のような番号を探します。\u003Cbr\u003E\\n\u003Cimg src=\\\"https:\u002F\u002Fqiita-image-store.s3.ap-northeast-1.amazonaws.com\u002F0\u002F502570\u002Fd48564de-3d9c-07e0-7aec-755e1b4444d5.jpeg\\\" alt=\\\"スクリーンショット 2020-08-07 16.56.07.jpg\\\"\u003E\u003Cbr\u003E\\n番号を見つけたら\u003Ccode\u003Eentry.番号=回答内容\u003C\u002Fcode\u003Eの形でパラメータを加えます。今回は名前と体温をテキストで入力するので以下のようなURLになります。\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=pp_url&amp;entry.1534939278=%E8%8D%92%E5%B7%9D%E6%99%BA%E5%89%87&amp;entry.511939456=36.5\\\"\u003Ehttps:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=36.5\u003C\u002Fa\u003E\u003Cbr\u003E\\nしかしこのままだと毎日36.5度を報告することになり、流石に怪しまれるので、乱数で良い感じに値を振ります。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003E\u003Cspan class=\\\"hljs-comment\\\"\u003E# 36.1~36.7の間でランダムに値を生成して文字列変換\u003C\u002Fspan\u003E\\nbody_temp = \u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-number\\\"\u003E36\u003C\u002Fspan\u003E + random.randint(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E)\u002F\u003Cspan class=\\\"hljs-number\\\"\u003E10\u003C\u002Fspan\u003E)\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E# URLの最後に加える\u003C\u002Fspan\u003E\\nurl = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;\u003C\u002Fspan\u003E+body_temp\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003ESeleniumで自動提出\u003C\u002Fh3\u003E\\n\u003Cp\u003EURLが完成したら、あとはSeleniumでURLを開き、ポチッと提出ボタンを押してもらうだけです。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003E\u003Cspan class=\\\"hljs-comment\\\"\u003E# SeleniumとChromedriverをpipでインストールしておく\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E selenium \u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E webdriver\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E chromedriver_binary\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E time\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E random\\n\\nbody_temp = \u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-number\\\"\u003E36\u003C\u002Fspan\u003E + random.randint(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E)\u002F\u003Cspan class=\\\"hljs-number\\\"\u003E10\u003C\u002Fspan\u003E)\\nurl = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;\u003C\u002Fspan\u003E+body_temp\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E# クリックの関数\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title function_\\\"\u003Eclick\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Expath\u003C\u002Fspan\u003E):\\n    driver.find_element_by_xpath(xpath).click()\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E# パスワード入力の関数\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title function_\\\"\u003Einsert_pw\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Expath, \u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E):\\n    driver.find_element_by_xpath(xpath).send_keys(\u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E)\\n\\ndriver = webdriver.Chrome()\\ndriver.implicitly_wait(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\ndriver.get(url)\\n\\nmoving_login_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv[3]\u002Fdiv[2]&#x27;\u003C\u002Fspan\u003E\\ntime.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E# Googleアカウントでのログインが必要な場合はログインする\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E(driver.find_elements_by_xpath(moving_login_button) != []):\\n  click(moving_login_button)\\n  login_id = \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;{Googleアカウントのメアド}&quot;\u003C\u002Fspan\u003E\\n  login_id_xpath = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fform\u002Fspan\u002Fsection\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Finput&#x27;\u003C\u002Fspan\u003E\\n  login_id_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\n  insert_pw(login_id_xpath, login_id)\\n  click(login_id_button)\\n  time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n  login_pw = \u003Cspan class=\\\"hljs-string\\\"\u003E&quot;{Googleアカウントのパスワード}&quot;\u003C\u002Fspan\u003E\\n  login_pw_xpath = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fform\u002Fspan\u002Fsection\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv\u002Fdiv\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Finput&#x27;\u003C\u002Fspan\u003E\\n  login_pw_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\n  insert_pw(login_pw_xpath, login_pw)\\n  time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n  click(login_pw_button)\\n\\ntime.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\nsubmit_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002F\u002F*[@id=&quot;mG61Hd&quot;]\u002Fdiv[2]\u002Fdiv\u002Fdiv[3]\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\nclick(submit_button)\\n\\n\u003Cspan class=\\\"hljs-built_in\\\"\u003Eprint\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-string\\\"\u003E&quot;Done!&quot;\u003C\u002Fspan\u003E)\\n\\ndriver.close\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E# メモリーを食うのでちゃんと終了しましょう\u003C\u002Fspan\u003E\\ndriver.quit\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003E\u003Cimg src=\\\"\u002Fmedia\u002Fgfa.webp\\\" alt=\\\"img\\\"\u003E\u003C\u002Fp\u003E\\n\u003Cp\u003Eしっかり送信できました。\u003C\u002Fp\u003E\\n\u003Ch2\u003E定期イベントにする\u003C\u002Fh2\u003E\\n\u003Cp\u003Eコードが書けたらあとは定期イベント化するだけなのですが、ここで少しつまづいたのでやり方を説明しておきます。\u003Cbr\u003E\\n \u003Cbr\u003E\\n \u003Cbr\u003E\\n当初予定していた方法としてはAutomatorでアプリ化し、カレンダーに入れて毎日実行する方法(\u003Ca href=\\\"https:\u002F\u002Fqiita.com\u002Fbaraobara\u002Fitems\u002F73d753c678e5c0e72f46#4-mac%E3%81%AE%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AEautomator%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6mac%E5%86%85%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8B\\\"\u003E参考\u003C\u002Fa\u003E)。これなら報告しなくて良い日はカレンダーから外せば良いし、完璧なはず。と思ったのですが、PCをシャットダウンしていると動作しないためボツ。crontabに設定して定期イベント化する方法も同様の理由でボツ。\u003C\u002Fp\u003E\\n\u003Cp\u003E結局臨機応変にイベントの変更はできないものの、PCの状態にかかわらず実行してくれるAWSのLambdaを使用することに決めました。(Lambdaの使い方は\u003Ca href=\\\"https:\u002F\u002Fwww.wakuwakubank.com\u002Fposts\u002F519-aws-lambda-introduction\u002F\\\"\u003Eこのサイト\u003C\u002Fa\u003Eとかが参考になりました)\u003C\u002Fp\u003E\\n\u003Ch3\u003ELambdaのレイヤーにSeleniumとChromedriver、headless-chromiumを上げる\u003C\u002Fh3\u003E\\n\u003Cp\u003ELambdaでライブラリを使うには各フォルダをzipに圧縮してレイヤーにアップロードする必要があります。今回はSeleniumとChromeのWebdriverであるChromedriver、それからChromeを開かずにスクレイピングを行うためのheadless-chromiumを使用するので、それぞれzipに圧縮してレイヤーに上げていきます。\u003C\u002Fp\u003E\\n\u003Ch4\u003E1. Selenium\u003C\u002Fh4\u003E\\n\u003Cpre\u003E\u003Ccode\u003Emkdir selenium\\ncd selenium\\nmkdir python\\ncd python\\npip install selenium -t .\\ncd ..\u002F\\nzip -r selenium.zip .\u002Fpython\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eできたzipファイルをそのままレイヤーにアップロードします。\u003C\u002Fp\u003E\\n\u003Ch4\u003E2. Chromedriverとheadless-chromium\u003C\u002Fh4\u003E\\n\u003Cpre\u003E\u003Ccode\u003Ecurl https:\u002F\u002Fgithub.com\u002Fadieuadieu\u002Fserverless-chrome\u002Freleases\u002Fdownload\u002Fv1.0.0-55\u002Fstable-headless-chromium-amazonlinux-2017-03.zip &gt; headless-chromium.zip\\ncurl https:\u002F\u002Fchromedriver.storage.googleapis.com\u002F2.43\u002Fchromedriver_linux64.zip &gt; chromedriver.zip\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eできた二つのzipファイルを解凍し、headless-chromeフォルダにまとめます。その後そのheadless-chromeをzipに圧縮してレイヤーにアップロードします。\u003C\u002Fp\u003E\\n\u003Ch4\u003E3. レイヤーを関数に適用\u003C\u002Fh4\u003E\\n\u003Cp\u003E関数の下にある「Layers」を押し、下の「レイヤーの追加」ボタンから二つのレイヤを追加します\u003Cbr\u003E\\n\u003Cimg width=\\\"1612\\\" alt=\\\"スクリーンショット 2020-08-07 18.36.45.png\\\" src=\\\"https:\u002F\u002Fqiita-image-store.s3.ap-northeast-1.amazonaws.com\u002F0\u002F502570\u002F27d63d99-6a12-7370-3e32-46851977176f.png\\\"\u003E\u003C\u002Fp\u003E\\n\u003Ch4\u003E※注意※\u003C\u002Fh4\u003E\\n\u003Cul\u003E\\n\u003Cli\u003ELambda関数のランタイムをPython3.8にするとChromedriverが動いてくれなかった(原因不明)ので、ランタイムはPython3.6か3.7に設定することをお勧めします。\u003C\u002Fli\u003E\\n\u003Cli\u003Eheadless-chromiumとChromedriverの間に互換性がないと動作しないので\u003Ca href=\\\"http:\u002F\u002Fchromedriver.chromium.org\u002Fdownloads\\\"\u003Eこちら\u003C\u002Fa\u003Eから最新版を入手しても動作しない可能性があります。\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch3\u003ELambda用にコードを少し変える\u003C\u002Fh3\u003E\\n\u003Cp\u003E筆者は今までCloud9以外のAWSツールを使ったことがないへっぽこコーダーなので、色んなサイトの見様見真似でなんとかLambdaで動くコードにしました。先人に感謝。\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"language-python\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E json\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E selenium \u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E webdriver\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E time\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E random\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title function_\\\"\u003Elambda_handler\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Eevent, context\u003C\u002Fspan\u003E):\\n    body_temp = \u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-number\\\"\u003E36\u003C\u002Fspan\u003E + random.randint(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E,\u003Cspan class=\\\"hljs-number\\\"\u003E7\u003C\u002Fspan\u003E)\u002F\u003Cspan class=\\\"hljs-number\\\"\u003E10\u003C\u002Fspan\u003E)\\n    url = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;https:\u002F\u002Fdocs.google.com\u002Fforms\u002Fd\u002Fe\u002F1FAIpQLScGgZ8dsBkcSVutvW3JgDLqy3pIEKk12ucjiA8mNQrKopILog\u002Fviewform?usp=pp_url&amp;entry.1534939278=荒川智則&amp;entry.511939456=&#x27;\u003C\u002Fspan\u003E+body_temp\\n    options = webdriver.ChromeOptions()\\n    options.binary_location = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fopt\u002Fheadless-chrome\u002Fheadless-chromium&#x27;\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"hljs-comment\\\"\u003E# このオプション4つを付けないとChromeは起動せずエラーになります\u003C\u002Fspan\u003E\\n    options.add_argument(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;--headless&#x27;\u003C\u002Fspan\u003E) \u003Cspan class=\\\"hljs-comment\\\"\u003E# サーバーレスでChromeを起動\u003C\u002Fspan\u003E\\n    options.add_argument(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;--no-sandbox&#x27;\u003C\u002Fspan\u003E) \u003Cspan class=\\\"hljs-comment\\\"\u003E# sandbox外でChromeを起動\u003C\u002Fspan\u003E\\n    options.add_argument(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;--single-process&#x27;\u003C\u002Fspan\u003E) \u003Cspan class=\\\"hljs-comment\\\"\u003E# タブ\u002Fサイトごとのマルチプロセスではなく、シングルプロセスへ切り替える\u003C\u002Fspan\u003E\\n    options.add_argument(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;--disable-dev-shm-usage&#x27;\u003C\u002Fspan\u003E) \u003Cspan class=\\\"hljs-comment\\\"\u003E# メモリファイルの出力場所を変える\u003C\u002Fspan\u003E\\n    driver = webdriver.Chrome(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fopt\u002Fheadless-chrome\u002Fchromedriver&#x27;\u003C\u002Fspan\u003E,options = options)\\n    driver.implicitly_wait(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n    driver.get(url)\\n    \\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title function_\\\"\u003Eclick\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Expath\u003C\u002Fspan\u003E):\\n        driver.find_element_by_xpath(xpath).click()\\n\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title function_\\\"\u003Einsert_pw\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Expath, \u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E):\\n        driver.find_element_by_xpath(xpath).send_keys(\u003Cspan class=\\\"hljs-built_in\\\"\u003Estr\u003C\u002Fspan\u003E)\\n    \\n    moving_login_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv[3]\u002Fdiv[2]&#x27;\u003C\u002Fspan\u003E\\n    time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E2\u003C\u002Fspan\u003E)\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Eif\u003C\u002Fspan\u003E(driver.find_elements_by_xpath(moving_login_button) != []):\\n        click(moving_login_button)\\n        \u003Cspan class=\\\"hljs-comment\\\"\u003E# 環境変数でMY_GMAILにGoogleアカウントのメアドを設定してください\u003C\u002Fspan\u003E\\n        login_id = MY_GMAIL\\n        login_id_xpath = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fform\u002Fspan\u002Fsection\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Finput&#x27;\u003C\u002Fspan\u003E\\n        login_id_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\n        insert_pw(login_id_xpath, login_id)\\n        click(login_id_button)\\n        time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n        \u003Cspan class=\\\"hljs-comment\\\"\u003E# 環境変数でMY_PASSWORDにGoogleアカウントのパスワードを設定してください\u003C\u002Fspan\u003E\\n        login_pw = MY_PASSWORD\\n        login_pw_xpath = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fform\u002Fspan\u002Fsection\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv\u002Fdiv\u002Fdiv\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv[1]\u002Finput&#x27;\u003C\u002Fspan\u003E\\n        login_pw_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002Fhtml\u002Fbody\u002Fdiv[1]\u002Fdiv[1]\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[2]\u002Fdiv\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\n        insert_pw(login_pw_xpath, login_pw)\\n        time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n        click(login_pw_button)\\n    time.sleep(\u003Cspan class=\\\"hljs-number\\\"\u003E1\u003C\u002Fspan\u003E)\\n    submit_button = \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;\u002F\u002F*[@id=&quot;mG61Hd&quot;]\u002Fdiv[2]\u002Fdiv\u002Fdiv[3]\u002Fdiv[1]\u002Fdiv\u002Fdiv&#x27;\u003C\u002Fspan\u003E\\n    click(submit_button)\\n    driver.close\\n    driver.quit\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E {\\n        \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;statusCode&#x27;\u003C\u002Fspan\u003E: \u003Cspan class=\\\"hljs-number\\\"\u003E200\u003C\u002Fspan\u003E,\\n        \u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;body&#x27;\u003C\u002Fspan\u003E: json.dumps(\u003Cspan class=\\\"hljs-string\\\"\u003E&#x27;Form submission success!!&#x27;\u003C\u002Fspan\u003E)\\n    }\\n\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch4\u003E注意点\u003C\u002Fh4\u003E\\n\u003Cul\u003E\\n\u003Cli\u003EChromeの起動オプション\u003Ccode\u003E--headless\u003C\u002Fcode\u003E,\u003Ccode\u003E--no-sandbox\u003C\u002Fcode\u003E,\u003Ccode\u003Esingle-process\u003C\u002Fcode\u003E,\u003Ccode\u003E--disable-dev-shm-usage\u003C\u002Fcode\u003Eを付けないとLambda上で正常に起動せず、エラーが出ます。各オプションについての詳細は\u003Ca href=\\\"http:\u002F\u002Fchrome.half-moon.org\u002F43.html\\\"\u003Eこちら\u003C\u002Fa\u003Eをご覧ください\u003C\u002Fli\u003E\\n\u003Cli\u003Eレイヤーにアップロードしたファイルはoptディレクトリの配下に置かれます。パスを指定する際はopt\u002Fディレクトリ名\u002F…の形で表記しましょう\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Ch3\u003ECloudWatch Eventsでトリガーを設定\u003C\u002Fh3\u003E\\n\u003Col\u003E\\n\u003Cli\u003E関数の「Layers」をクリックして「トリガーを追加をクリック」し、ドロップダウンから「EventBridge (CloudWatch Events)」を選択します。\u003C\u002Fli\u003E\\n\u003Cli\u003Eルールは「新規ルールの作成」で任意のルール名を入力。ルールタイプをスケジュール式にし、今回は毎日朝5時なので\u003Ccode\u003Ecorn(0 20 ? * * *)\u003C\u002Fcode\u003Eと入力(LambdaはUTCでトリガーされるので9時間前をセットすることに留意)。トリガーを有効にして「追加」をクリックします。（cronの書き方は\u003Ca href=\\\"https:\u002F\u002Fqiita.com\u002Ftossh\u002Fitems\u002Fe135bd063a50087c3d6a\\\"\u003Eこちら\u003C\u002Fa\u003Eをご覧ください）\u003C\u002Fli\u003E\\n\u003C\u002Fol\u003E\\n\u003Cimg width=\\\"810\\\" alt=\\\"スクリーンショット 2020-08-07 18.56.44.png\\\" src=\\\"https:\u002F\u002Fqiita-image-store.s3.ap-northeast-1.amazonaws.com\u002F0\u002F502570\u002F2c07b4d3-295d-7543-7de7-dc8b0efaf40b.png\\\"\u003E\\n\u003Ch2\u003Eテスト\u003C\u002Fh2\u003E\\n\u003Cp\u003E最後にしっかり動くかテストしましょう。Lambda関数画面の「テスト」をクリックします。\u003Cbr\u003E\\n\u003Cimg width=\\\"1613\\\" alt=\\\"スクリーンショット 2020-08-07 18.51.28.png\\\" src=\\\"https:\u002F\u002Fqiita-image-store.s3.ap-northeast-1.amazonaws.com\u002F0\u002F502570\u002F8418067e-0784-9b2c-feeb-624c132e277d.png\\\"\u003E\u003Cbr\u003E\\n大丈夫そうですね。\u003C\u002Fp\u003E\\n\u003Ch2\u003Eおわりに\u003C\u002Fh2\u003E\\n\u003Cp\u003E朝の検温はサボっていますが、寝る前にちゃんと測っているので安心してください。\u003C\u002Fp\u003E\\n\u003Ch2\u003E参考文献\u003C\u002Fh2\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fmasakimisawa.com\u002Fselenium_headless-chrome_python_on_lambda\u002F\\\"\u003Ehttps:\u002F\u002Fmasakimisawa.com\u002Fselenium_headless-chrome_python_on_lambda\u002F\u003C\u002Fa\u003E\u003Cbr\u003E\\n\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fheroku\u002Fheroku-buildpack-google-chrome\u002Fissues\u002F56\\\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fheroku\u002Fheroku-buildpack-google-chrome\u002Fissues\u002F56\u003C\u002Fa\u003E\u003Cbr\u003E\\n\u003Ca href=\\\"https:\u002F\u002Fqiita.com\u002Fmishimay\u002Fitems\u002Fafd7f247f101fbe25f30\\\"\u003Ehttps:\u002F\u002Fqiita.com\u002Fmishimay\u002Fitems\u002Fafd7f247f101fbe25f30\u003C\u002Fa\u003E\u003C\u002Fp\u003E\\n\"}"}</script>
		</div>
	</body>
</html>
